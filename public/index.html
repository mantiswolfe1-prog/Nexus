<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" href="%PUBLIC_URL%/favicon.ico" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="theme-color" content="#000000" />
    <meta
      name="description"
      content="Nexus - Privacy-first, local-only student hub"
    />
    <link rel="apple-touch-icon" href="%PUBLIC_URL%/logo192.png" />
    <link rel="manifest" href="%PUBLIC_URL%/manifest.json" />
    <title>Nexus - Student Hub</title>
    <script>
      // Anti-direct-access protection: redirect to about:blank immediately
      // Only allow access if running in iframe (embedded=true)
      (function() {
        const params = new URLSearchParams(window.location.search);
        const isEmbedded = params.has('embedded');
        const isInIframe = window.self !== window.top;
        
        // If accessed directly (not embedded), navigate to about:blank
        // The fake error will be rendered client-side inside the iframe
        if (!isEmbedded && !isInIframe) {
          const APP_URL = window.location.origin + window.location.pathname;
          const iframeMarkup = `<!doctype html>
<html><head><style>
html,body { margin:0; padding:0; width:100%; height:100%; background:#000; overflow:hidden; }
iframe { border:0; width:100%; height:100%; }
</style></head>
<body>
<iframe src="${APP_URL}?embedded=true" allow="fullscreen; clipboard-read; clipboard-write" referrerpolicy="no-referrer"></iframe>
</body></html>`;
          
          window.location.href = 'about:blank';
          // The about:blank redirect happens in the launcher
          const child = window.open('about:blank', '_self');
          if (child) {
            setTimeout(() => {
              try {
                child.document.open();
                child.document.write(iframeMarkup);
                child.document.close();
              } catch (e) {
                // about:blank security - fallback to navigation
              }
            }, 100);
          }
        }
      })();
    </script>
  </head>
  <body>
    <noscript>You need to enable JavaScript to run this app.</noscript>
    <div id="root"></div>
  </body>
</html>